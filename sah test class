@IsTest
static void generates_ok_withDirectOverrides() {
    // Account + Person Contact
    Account a = new Account(
        RecordTypeId = Schema.SObjectType.Account.getRecordTypeInfosByName().get('Person Account').getRecordTypeId(),
        LastName = 'Tester',
        FirstName = 'Pat',
        PersonEmail = 'pat.tester@example.com',
        Phone = '0400000000',
        Home_Address__Street__s = '10 Dickson Road',
        Home_Address__City__s = 'GOONDI BEND',
        Home_Address__StateCode__s = 'QLD',
        Home_Address__PostalCode__s = '4860',
        Home_Address__CountryCode__s = 'AU'
    );
    insert a;

    // Funding (no Name set)
    maica_cc__Funding__c f = new maica_cc__Funding__c(
        maica_cc__Start_Date__c = Date.today(),
        maica_cc__End_Date__c   = Date.today().addMonths(6),
        Funding_Type__c         = 'NDIS'
    );
    insert f;

    // Funding Item (no Name set)
    maica_cc__Funding_Item__c fi = new maica_cc__Funding_Item__c(
        maica_cc__Funding__c          = f.Id,
        maica_cc__Budget_Type__c      = 'Assistive technology',
        maica_cc__Approved_Amount__c  = 1500,
        maica_cc__Entry_Date__c       = Date.today(),
        maica_cc__Effective_Date__c   = Date.today(),
        maica_cc__End_Date__c         = Date.today().addMonths(6)
    );
    insert fi;

    // Personâ€™s CCR (PoA only). DO NOT set Relationship__c (often not createable in tests).
    Contact related = new Contact(LastName='Rep', Phone='0411111111', Email='rep@example.com');
    insert related;
    insert new ContactContactRelation(
        ContactId            = a.PersonContactId,
        RelatedContactId     = related.Id,
        Power_of_Attorney__c = 'General',     // picklist value that exists in your org
        Next_of_Kin__c       = false
    );

    // A DocumentTemplate and a ContentVersion for the override inputs
    DocumentTemplate tmpl = new DocumentTemplate(Name = 'SupportAtHomeAgreement_Direct', IsActive = true);
    insert tmpl;

    // Fake template file for ContentVersion override
    ContentVersion cv = new ContentVersion(
        Title = 'UnitTestTemplate',
        VersionData = Blob.valueOf('dummy'),
        PathOnClient = 'UnitTestTemplate.docx'
    );
    insert cv;

    // Opportunity under test
    Opportunity opp = new Opportunity(
        Name = 'Test Opp',
        StageName = 'Prospecting',
        CloseDate = Date.today().addDays(10),
        AccountId = a.Id,
        Funding__c = f.Id,
        Funding_Source__c = 'Support at Home'
    );
    insert opp;

    // Call the invocable with direct overrides (avoid CMDT in tests)
    MC_SAHOpportunityDocGen_Direct.Wrapper w = new MC_SAHOpportunityDocGen_Direct.Wrapper();
    w.recordIds = new List<Id>{ opp.Id };
    w.docTemplateName = tmpl.Name;
    w.templateContentVersionId = cv.Id;

    Test.startTest();
    MC_SAHOpportunityDocGen_Direct.generateFromFlow(new List<MC_SAHOpportunityDocGen_Direct.Wrapper>{ w });
    Test.stopTest();

    // In tests, your class skips inserting DocumentGenerationProcess (guarded by Test.isRunningTest()).
    // So just assert we got here without exceptions.
    System.assert(true, 'DocGen executed without throwing.');
}